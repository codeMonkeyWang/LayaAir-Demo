!function(t,i,e){var a=(e.un,e.uns,e["static"]),s=e["class"],r=e.getset,n=e.__newvec,h=laya.utils.Browser,l=laya.utils.Byte,o=(laya.events.Event,laya.events.EventDispatcher),u=laya.display.Graphics,_=laya.utils.Handler,c=laya.net.Loader,p=laya.maths.MathUtil,d=laya.maths.Matrix,f=laya.renders.Render,y=laya.utils.RunDriver,m=laya.display.Sprite,x=laya.utils.Stat,g=laya.resource.Texture,D=laya.net.URL,v=(function(){function t(){}return s(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2,t}(),function(){function t(){this.name=null,this._parent=null,this.length=10,this.transform=null,this.sprite=null,this._children=[],this.resultTransform=new C,this.resultMatrix=new d}s(t,"laya.ani.bone.Bone");var i=t.prototype;return i.update=function(t){var i;t?(i=this.resultTransform.getMatrix(),d.mul(i,t,this.resultMatrix)):this._parent?(i=this.resultTransform.getMatrix(),d.mul(i,this._parent.resultMatrix,this.resultMatrix)):(i=this.resultTransform.getMatrix(),i.copyTo(this.resultMatrix));var e,a=0,s=0;for(a=0,s=this._children.length;s>a;a++)e=this._children[a],e.update()},i.updateDraw=function(t,i){this.sprite?(this.sprite.x=t+this.resultMatrix.tx,this.sprite.y=i+this.resultMatrix.ty):(this.sprite=new m,this.sprite.graphics.drawCircle(0,0,5,"#ff0000"),e.stage.addChild(this.sprite),this.sprite.x=t+this.resultMatrix.tx,this.sprite.y=i+this.resultMatrix.ty);var a,s=0,r=0;for(s=0,r=this._children.length;r>s;s++)a=this._children[s],a.updateDraw(t,i)},i.addChild=function(t){this._children.push(t),t._parent=this},i.findBone=function(t){if(this.name==t)return this;var i,e,a=0,s=0;for(a=0,s=this._children.length;s>a;a++)if(i=this._children[a],e=i.findBone(t))return e;return null},t}()),I=function(){function t(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null}s(t,"laya.ani.bone.BoneSlot");var i=t.prototype;return i.showSlotData=function(t){this.currSlotData=t,this.displayIndex=this.srcDisplayIndex,this.currDisplayData=null,this.currTexture=null},i.showDisplayByName=function(t){this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},i.showDisplayByIndex=function(t){if(this.currSlotData&&t>-1&&t<this.currSlotData.displayArr.length){if(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData){var i=this.currDisplayData.name;this.currTexture=this.templet.getTexture(i),this.currTexture&&f.isWebGL&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(this.currTexture=new g(this.currTexture.bitmap,this.currDisplayData.uvs))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},i.replaceSkin=function(t){this._diyTexture=t},i.setParentMatrix=function(t){this._parentMatrix=t},i.draw=function(t,i,e,a){if(void 0===a&&(a=!1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var s=this.currTexture;this._diyTexture&&(s=this._diyTexture);var r;switch(this.currDisplayData.type){case 0:if(t){var n=this.getDisplayMatrix();if(this._parentMatrix){var h=!1;if(n){d.mul(n,this._parentMatrix,d.TEMP);var l;if(a?(null==this._resultMatrix&&(this._resultMatrix=new d),l=this._resultMatrix):l=new d,!f.isWebGL&&this.currDisplayData.uvs){var o=new d(1,0,0,1);this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(o.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(h=!0,o.rotate(-Math.PI/2)),d.mul(o,d.TEMP,l)}else d.TEMP.copyTo(l);h?t.drawTexture(s,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,l):t.drawTexture(s,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,l)}}}break;case 1:if(r=y.skinAniSprite(),null==r)return;t.drawSkin(r);var u=[],_=[],c=1,p=1,m=1,x=1;if(null==this.currDisplayData.bones){for(var g=0,D=0;g<this.currDisplayData.weights.length&&D<this.currDisplayData.uvs.length;){var v=this.currDisplayData.weights[g++],I=this.currDisplayData.weights[g++];u.push(v,I,this.currDisplayData.uvs[D++],this.currDisplayData.uvs[D++],c,p,m,x)}var M=this.currDisplayData.triangles.length/3;for(g=0;M>g;g++)_.push(this.currDisplayData.triangles[3*g]),_.push(this.currDisplayData.triangles[3*g+1]),_.push(this.currDisplayData.triangles[3*g+2]);r.init(this.currTexture,u,_);var T=this.getDisplayMatrix();if(this._parentMatrix&&T){d.mul(T,this._parentMatrix,d.TEMP);var b;a?(null==this._resultMatrix&&(this._resultMatrix=new d),b=this._resultMatrix):b=new d,d.TEMP.copyTo(b),r.transform=b}}else this.skinMesh(i,r);break;case 2:if(r=y.skinAniSprite(),null==r)return;t.drawSkin(r),this.skinMesh(i,r);break;case 3:}}},i.drawPath=function(t,i){var e,a=this.currDisplayData.bones,s=this.currDisplayData.weights,r=(this.currDisplayData.triangles,[]),n=0,h=0,l=0,o=NaN,u=NaN,_=0,c=0,p=[],d=0,f=0;for(d=0,f=a.length;f>d;){for(l=a[d++]+d,n=0,h=0;l>d;d++)e=t[a[d]],o=s[_],u=s[_+1],c=s[_+2],n+=(o*e.a+u*e.c+e.tx)*c,h+=(o*e.b+u*e.d+e.ty)*c,_+=3;p.push(n,h)}for(d=0;d<p.length;)n=p[d++],h=p[d++],i.drawCircle(n,h,2.5,"#ff0000"),r.push(n,h);for(var y=10,m=[],d=0;y>d;d++)this.addCurvePosition(d/y,p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],m,3*d,!0);for(d=0;y>d;d++)i.drawCircle(m[3*d],m[3*d+1],2.5,"#00ff00")},i.addCurvePosition=function(t,i,e,a,s,r,n,h,l,o,u,_){0==t&&(t=1e-4);var c=t*t,p=c*t,d=1-t,f=d*d,y=f*d,m=d*t,x=3*m,g=d*x,D=x*t,v=i*y+a*g+r*D+h*p,I=e*y+s*g+n*D+l*p;o[u]=v,o[u+1]=I,_&&(o[u+2]=Math.atan2(I-(e*f+s*m*2+n*c),v-(i*f+a*m*2+r*c)))},i.skinMesh=function(t,i){var e,a=this.currDisplayData.bones,s=this.currDisplayData.uvs,r=this.currDisplayData.weights,n=this.currDisplayData.triangles,h=[],l=[],o=0,u=0,_=0,c=NaN,p=NaN,d=0,f=0,y=[],m=0,x=0,g=0,D=1,v=1,I=1,M=1;for(m=0,g=a.length;g>m;){for(_=a[m++]+m,o=0,u=0;_>m;m++)e=t[a[m]],c=r[d],p=r[d+1],f=r[d+2],o+=(c*e.a+p*e.c+e.tx)*f,u+=(c*e.b+p*e.d+e.ty)*f,d+=3;y.push(o,u)}for(m=0,x=0;m<y.length&&x<s.length;)o=y[m++],u=y[m++],h.push(o,u,s[x++],s[x++],D,v,I,M);for(m=0,g=n.length;g>m;m++)l.push(n[m]);i.init(this.currTexture,h,l)},i.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},i.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},i.getMatrix=function(){return this._resultMatrix},i.copy=function(){var i=new t;return i.type="copy",i.name=this.name,i.attachmentName=this.attachmentName,i.srcDisplayIndex=this.srcDisplayIndex,i.parent=this.parent,i.displayIndex=this.displayIndex,i.templet=this.templet,i.currSlotData=this.currSlotData,i.currTexture=this.currTexture,i.currDisplayData=this.currDisplayData,i},t}(),M=function(){function t(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return s(t,"laya.ani.bone.IkConstraintData"),t}(),T=function(){function t(){this.name=null,this.slotArr=[]}return s(t,"laya.ani.bone.SkinData"),t}(),b=function(){function t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null}return s(t,"laya.ani.bone.SkinSlotDisplayData"),t}(),A=function(){function t(){this.name=null,this.displayArr=[]}s(t,"laya.ani.bone.SlotData");var i=t.prototype;return i.getDisplayByName=function(t){for(var i,e=0,a=this.displayArr.length;a>e;e++)if(i=this.displayArr[e],i.attachmentName==t)return e;return-1},t}(),C=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.mMatrix=null}s(t,"laya.ani.bone.Transform");var i=t.prototype;return i.initData=function(t){void 0!=t.x&&(this.x=t.x),void 0!=t.y&&(this.y=t.y),void 0!=t.skX&&(this.skX=t.skX),void 0!=t.skY&&(this.skY=t.skY),void 0!=t.scX&&(this.scX=t.scX),void 0!=t.scY&&(this.scY=t.scY)},i.getMatrix=function(){var t;if(t=this.mMatrix?this.mMatrix:this.mMatrix=new d,t.a=Math.cos(this.skY),0!=this.skX||0!=this.skY){var i=this.skX*Math.PI/180,e=Math.cos(i),a=Math.sin(i);t.setTo(this.scX*e,this.scX*a,this.scY*-a,this.scY*e,this.x,this.y)}else t.setTo(this.scX,this.skX,this.skY,this.scY,this.x,this.y);return t},t}(),F=function(t){function i(t){this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startPlayLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this.playbackRate=1,this.isCache=!0,this.returnToZeroStopped=!0,i.__super.call(this),void 0===t&&(t=60),this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startPlayLoopCount=-1,this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate}s(i,"laya.ani.AnimationPlayer",t);var e=i.prototype;return e._calculatePlayDuration=function(){if(0!==this.state){var t=this._templet.getAniDuration(this._currentAnimationClipIndex);if(0===this._playEnd&&(this._playEnd=t),Math.floor(this._playEnd)>t)throw new Error("AnimationPlayer:playEnd must less than original Duration.");this._playDuration=this._playEnd-this._playStart}},e.play=function(t,i,e,a,s){if(void 0===t&&(t=0),void 0===i&&(i=1),void 0===e&&(e=Number.MAX_VALUE),void 0===a&&(a=0),void 0===s&&(s=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(0>e||0>a||0>s)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==s&&a>s)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=i,this._overallDuration=e,this._playStart=a,this._playEnd=s,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startPlayLoopCount=x.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._calculatePlayDuration)},e.playByFrame=function(t,i,e,a,s,r){void 0===t&&(t=0),void 0===i&&(i=1),void 0===e&&(e=Number.MAX_VALUE),void 0===a&&(a=0),void 0===s&&(s=0),void 0===r&&(r=30);var n=1e3/r;this.play(t,i,e,a*n,s*n)},e.stop=function(t){void 0===t&&(t=!0),t?(this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},e.update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var i=0;this._startPlayLoopCount!==x.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var e=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=e)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,void this.event("stopped");if(i+=this._currentTime,e>0){for(;i>=e;){if(this._stopWhenCircleFinish)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this._stopWhenCircleFinish=!1,void this.event("stopped");i-=e}this._currentTime=i,this._currentKeyframeIndex=Math.floor(this.currentPlayTime/this._cacheFrameRateInterval),this._currentFrameTime=this._currentKeyframeIndex*this._cacheFrameRateInterval}else{if(this._stopWhenCircleFinish)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0}}},r(0,e,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),r(0,e,"templet",function(){return this._templet},function(t){0===!this.state&&this.stop(!0),this._templet=t}),r(0,e,"currentPlayTime",function(){return this._currentTime+this._playStart}),r(0,e,"playStart",function(){return this._playStart}),r(0,e,"playEnd",function(){return this._playEnd}),r(0,e,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),r(0,e,"playDuration",function(){return this._playDuration}),r(0,e,"cacheFrameRate",function(){return this._cacheFrameRate}),r(0,e,"currentFrameTime",function(){return this._currentFrameTime}),r(0,e,"currentTime",null,function(t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._currentTime=t,this._currentKeyframeIndex=Math.floor(this.currentPlayTime/this._cacheFrameRateInterval),this._currentFrameTime=this._currentKeyframeIndex*this._cacheFrameRateInterval}}),r(0,e,"overallDuration",function(){return this._overallDuration}),r(0,e,"paused",function(){return this._paused},function(t){this._paused=t,t&&this.event("paused")}),r(0,e,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),r(0,e,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),i}(o),k=function(t){function i(){this._aniMap={},this.unfixedLastAniIndex=-1,this._loaded=!1,this._animationDatasCache=[],i.__super.call(this),this._anis=new Array}s(i,"laya.ani.KeyframesAniTemplet",t);var e=i.prototype;return e.parse=function(t,e){var a=0,s=0,r=0,n=0,h=0,o=new l(t);this._aniVersion=o.readUTFString();var u,_=(o.readUTFString(),o.readUTFString().split("\n")),c=o.getUint8(),p=o.getUint32(),d=o.getUint32();p>0&&(u=t.slice(p,d));var f=new l(u);for(d>0&&(this._publicExtData=t.slice(d,t.byteLength)),this._useParent=!!o.getUint8(),this._anis.length=c,a=0;c>a;a++){var y=this._anis[a]={};y.nodes=new Array;var m=y.name=_[o.getUint16()];this._aniMap[m]=a,y.bone3DMap={},y.playTime=o.getFloat32();var x=y.nodes.length=o.getUint8();for(y.totalKeyframesLength=0,s=0;x>s;s++){var g=y.nodes[s]={};g.childs=[];var D=o.getInt16();D>=0&&(g.name=_[D],y.bone3DMap[g.name]=s),g.keyFrame=new Array,g.parentIndex=o.getInt16(),-1==g.parentIndex?g.parent=null:g.parent=y.nodes[g.parentIndex];var v=!!o.getUint8(),I=o.getUint32();f.pos=I;var M=g.keyframeWidth=f.getUint16();if(y.totalKeyframesLength+=M,v)for(g.interpolationMethod=[],g.interpolationMethod.length=M,r=0;M>r;r++)g.interpolationMethod[r]=i.interpolation[f.getUint8()];null!=g.parent&&g.parent.childs.push(g);var T=o.getUint16();T>0&&(g.extenData=t.slice(o.pos,o.pos+T),o.pos+=T);var b=o.getUint16();g.keyFrame.length=b;var A=0;for(r=0,n=b;n>r;r++){var C=g.keyFrame[r]={};for(C.duration=o.getFloat32(),C.startTime=A,C.data=new Float32Array(M),C.dData=new Float32Array(M),C.nextData=new Float32Array(M),h=0;M>h;h++)C.data[h]=o.getFloat32(),C.data[h]>-1e-8&&C.data[h]<1e-8&&(C.data[h]=0);A+=C.duration}g.playTime=y.playTime,this._calculateKeyFrame(g,b,M),this._calculateKeyFrameIndex(g,e)}}this._loaded=!0,this.event("loaded",this)},e._calculateKeyFrame=function(t,i,e){var a=t.keyFrame;a[i]=a[0];for(var s=0;i>s;s++)for(var r=a[s],n=0;e>n;n++)r.dData[n]=0===r.duration?0:(a[s+1].data[n]-r.data[n])/r.duration,r.nextData[n]=a[s+1].data[n];a.length--},e._calculateKeyFrameIndex=function(t,i){var e=1e3/i;t.frameCount=Math.floor(t.playTime/e),t.fullFrame=new Uint16Array(t.frameCount+1);for(var a=-1,s=0,r=t.keyFrame.length;r>s;s++){var n=t.keyFrame[s],h=n.startTime,l=h+n.duration+e;do{for(var o=Math.floor(h/e+.5),u=a+1;o>u;u++)t.fullFrame[u]=s;a=o,t.fullFrame[o]=s,h+=e}while(l>=h)}},e.getAnimationCount=function(){return this._anis.length},e.getAnimation=function(t){return this._anis[t]},e.getAniDuration=function(t){return this._anis[t].playTime},e.getNodes=function(t){return this._anis[t].nodes},e.getNodeIndexWithName=function(t,i){return this._anis[t].bone3DMap[i]},e.getNodeCount=function(t){return this._anis[t].nodes.length},e.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframesLength},e.getPublicExtData=function(){return this._publicExtData},e.getAnimationDataWithCache=function(t,i,e){var a=t[i];return a?a[e]:null},e.setAnimationDataWithCache=function(t,i,e,a){var s=t[i];s||(s=t[i]=[]),s[e]=a},e.getOriginalData=function(t,i,e,a){for(var s=this._anis[t],r=s.nodes,n=0,h=0,l=r.length,o=0;l>h;h++){var u,_=r[h];u=_.keyFrame[_.fullFrame[e]],_.dataOffset=o;var c=a-u.startTime;for(n=0;n<_.keyframeWidth;)n+=_.interpolationMethod[n](_,n,i,o+n,u.data,c,u.dData,u.duration,u.nextData);o+=_.keyframeWidth}},e.getNodesCurrentFrameIndex=function(t,i){var e=this._anis[t],a=e.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(a.length),this.unfixedCurrentTimes=new Float32Array(a.length),this.unfixedLastAniIndex=t);for(var s=0,r=a.length;r>s;s++){var n=a[s];for(i<this.unfixedCurrentTimes[s]&&(this.unfixedCurrentFrameIndexes[s]=0),this.unfixedCurrentTimes[s]=i;this.unfixedCurrentFrameIndexes[s]<n.keyFrame.length&&!(n.keyFrame[this.unfixedCurrentFrameIndexes[s]].startTime>this.unfixedCurrentTimes[s]);)this.unfixedCurrentFrameIndexes[s]++;this.unfixedCurrentFrameIndexes[s]--}return this.unfixedCurrentFrameIndexes},e.getOriginalDataUnfixedRate=function(t,i,e){var a=this._anis[t],s=a.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(s.length),this.unfixedCurrentTimes=new Float32Array(s.length),this.unfixedKeyframes=n(s.length),this.unfixedLastAniIndex=t);for(var r=0,h=0,l=s.length,o=0;l>h;h++){var u=s[h];for(e<this.unfixedCurrentTimes[h]&&(this.unfixedCurrentFrameIndexes[h]=0),this.unfixedCurrentTimes[h]=e;this.unfixedCurrentFrameIndexes[h]<u.keyFrame.length&&!(u.keyFrame[this.unfixedCurrentFrameIndexes[h]].startTime>this.unfixedCurrentTimes[h]);)this.unfixedKeyframes[h]=u.keyFrame[this.unfixedCurrentFrameIndexes[h]],this.unfixedCurrentFrameIndexes[h]++;var _=this.unfixedKeyframes[h];u.dataOffset=o;var c=e-_.startTime;for(r=0;r<u.keyframeWidth;)r+=u.interpolationMethod[r](u,r,i,o+r,_.data,c,_.dData,_.duration,_.nextData);o+=u.keyframeWidth}},r(0,e,"loaded",function(){return this._loaded}),i._LinearInterpolation_0=function(t,i,e,a,s,r,n,h,l){return e[a]=s[i]+r*n[i],1},i._QuaternionInterpolation_1=function(t,i,e,a,s,r,n,h,l){var o=0===h?0:r/h;return p.slerpQuaternionArray(s,i,l,i,o,e,a),4},i._AngleInterpolation_2=function(t,i,e,a,s,r,n,h,l){return 0},i._RadiansInterpolation_3=function(t,i,e,a,s,r,n,h,l){return 0},i._Matrix4x4Interpolation_4=function(t,i,e,a,s,r,n,h,l){for(var o=0;16>o;o++,i++)e[a+o]=s[i]+r*n[i];return 16},i._NoInterpolation_5=function(t,i,e,a,s,r,n,h,l){return e[a]=s[i],1},i._uniqueIDCounter=1,i.interpolation=[i._LinearInterpolation_0,i._QuaternionInterpolation_1,i._AngleInterpolation_2,i._RadiansInterpolation_3,i._Matrix4x4Interpolation_4,i._NoInterpolation_5],i.LAYA_ANIMATION_VISION="LAYAANIMATION:1.0.2",i}(o),S=function(t){function i(){i.__super.call(this)}s(i,"laya.ani.GraphicsAni",t);var e=i.prototype;return e.drawSkin=function(t){var i=[t];this._saveToCmd(f._context._drawSkin,i)},i}(u),N=function(t){function i(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.url=null,this.yReverseMatrix=null,this._rate=60,this.aniSectionDic={},this.textureDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.mRootBone=null,i.__super.call(this),this.mBoneArr=[]}s(i,"laya.ani.bone.Templet",t);var a=i.prototype;return a.loadAni=function(t){this._skBufferUrl=t,e.loader.load(t,_.create(this,this.onComplete),null,"arraybuffer")},a.onComplete=function(){var t=c.getRes(this._skBufferUrl);this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,t)},a.parseData=function(t,i,e){void 0===e&&(e=60),this._mainTexture=t,this._rate=e,this.parse(i,e)},a.buildArmature=function(t){return void 0===t&&(t=0),new w(this,t)},a.parse=function(i,e){t.prototype.parse.call(this,i,e),this._aniVersion!=k.LAYA_ANIMATION_VISION&&(console.log("[Error] 版本不一致，请使用IDE版本（1.2.0）重新导出"),this._loaded=!1),this._loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},a._parseTexturePath=function(){var t=0;this._loadList=[];var i,a=new l(this.getPublicExtData()),s=0,r=0,n=0,h=0,o=0,u=0,c=0,p=0,d=0,f=a.getUint8(),y=a.readUTFString(),m=y.split("\n");for(t=0;f>t;t++)i=this._path+m[2*t],y=m[2*t+1],s=a.getFloat32(),r=a.getFloat32(),n=a.getFloat32(),h=a.getFloat32(),d=a.getFloat32(),o=isNaN(d)?0:d,d=a.getFloat32(),u=isNaN(d)?0:d,d=a.getFloat32(),c=isNaN(d)?n:d,d=a.getFloat32(),p=isNaN(d)?h:d,-1==this._loadList.indexOf(i)&&this._loadList.push(i);e.loader.load(this._loadList,_.create(this,this._textureComplete))},a._textureComplete=function(){for(var t,i,e=0,a=this._loadList.length;a>e;e++)i=this._loadList[e],t=this._textureDic[i]=c.getRes(i);this._parsePublicExtData()},a._parsePublicExtData=function(){var t=0,i=0,e=0,a=0,s=0;for(t=0,s=this.getAnimationCount();s>t;t++)this._graphicsCache.push([]);var r,n,h=new l(this.getPublicExtData()),o=0,u=0,_=0,c=0,p=0,f=0,y=0,m=0,x=0,D=h.getUint8(),F=h.readUTFString(),k=F.split("\n");for(t=0;D>t;t++)r=this._mainTexture,n=this._path+k[2*t],F=k[2*t+1],null==this._mainTexture&&(r=this._textureDic[n]),o=h.getFloat32(),u=h.getFloat32(),_=h.getFloat32(),c=h.getFloat32(),x=h.getFloat32(),p=isNaN(x)?0:x,x=h.getFloat32(),f=isNaN(x)?0:x,x=h.getFloat32(),y=isNaN(x)?_:x,x=h.getFloat32(),m=isNaN(x)?c:x,this.subTextureDic[F]=g.create(r,o,u,_,c,-p,-f,y,m);var S,N=h.getUint16();for(t=0;N>t;t++)S=[],S.push(h.getUint16()),S.push(h.getUint16()),S.push(h.getUint16()),this.aniSectionDic[t]=S;var w,P,U,B,L=h.getInt16(),E={};for(t=0;L>t;t++)w=new v,U=h.readUTFString(),B=h.readUTFString(),w.length=h.getFloat32(),w.name=U,B&&(P=E[B],P?P.addChild(w):this.mRootBone=w),E[U]=w,this.mBoneArr.push(w);var R,O=h.getUint16(),X=h.getUint16(),Y=Math.floor(X/O),K=this.srcBoneMatrixArr;for(t=0;Y>t;t++)R=new C,R.scX=h.getFloat32(),R.skX=h.getFloat32(),R.skY=h.getFloat32(),R.scY=h.getFloat32(),R.x=h.getFloat32(),R.y=h.getFloat32(),K.push(R),w=this.mBoneArr[t],w.transform=R;var W,G=h.getUint16(),V=0;for(t=0;G>t;t++){for(W=new M,V=h.getUint16(),i=0;V>i;i++)W.boneNames.push(h.readUTFString()),W.boneIndexs.push(h.getInt16());W.name=h.readUTFString(),W.targetBoneName=h.readUTFString(),W.targetBoneIndex=h.getInt16(),W.bendDirection=h.getFloat32(),W.mix=h.getFloat32(),this.ikArr.push(W)}var q,z,Q=h.getInt16();for(t=0;Q>t;t++)q=new I,q.name=h.readUTFString(),q.parent=h.readUTFString(),q.attachmentName=h.readUTFString(),q.srcDisplayIndex=q.displayIndex=h.getInt16(),q.templet=this,this.boneSlotDic[q.name]=q,z=this.bindBoneBoneSlotDic[q.parent],null==z&&(this.bindBoneBoneSlotDic[q.parent]=z=[]),z.push(q),this.boneSlotArray.push(q);var $,Z,H,J=h.readUTFString(),j=J.split("\n"),tt=0,it=h.getUint8(),et=0,at=0,st=0,rt=0,nt=0,ht=0;for(t=0;it>t;t++){for($=new T,$.name=j[tt++],et=h.getUint8(),i=0;et>i;i++){for(Z=new A,Z.name=j[tt++],q=this.boneSlotDic[Z.name],at=h.getUint8(),e=0;at>e;e++){if(H=new b,H.name=j[tt++],H.attachmentName=j[tt++],H.transform=new C,H.transform.scX=h.getFloat32(),H.transform.skX=h.getFloat32(),H.transform.skY=h.getFloat32(),H.transform.scY=h.getFloat32(),H.transform.x=h.getFloat32(),H.transform.y=h.getFloat32(),Z.displayArr.push(H),H.width=h.getFloat32(),H.height=h.getFloat32(),H.type=h.getUint8(),L=h.getUint16(),L>0)for(H.bones=[],a=0;L>a;a++){var lt=h.getUint16();H.bones.push(lt)}if(st=h.getUint16(),st>0)for(H.uvs=[],a=0;st>a;a++)H.uvs.push(h.getFloat32());if(rt=h.getUint16(),rt>0)for(H.weights=[],a=0;rt>a;a++)H.weights.push(h.getFloat32());if(nt=h.getUint16(),nt>0)for(H.triangles=[],a=0;nt>a;a++)H.triangles.push(h.getUint16());if(ht=h.getUint16(),ht>0)for(H.vertices=[],a=0;ht>a;a++)H.vertices.push(h.getFloat32())}$.slotArr.push(Z)}this.skinDic[$.name]=$,this.skinDataArray.push($)}var ot=h.getUint8();1==ot&&(this.yReverseMatrix=new d(1,0,0,-1,0,0)),this.showSkinByIndex(this.boneSlotDic,0),this.event("complete",this)},a.getTexture=function(t){return this.subTextureDic[t]},a.showSkinByIndex=function(t,i){if(!(0>i&&i>=this.skinDataArray.length)){var e,a,s=0,r=0,n=this.skinDataArray[i];if(n)for(s=0,r=n.slotArr.length;r>s;s++)a=n.slotArr[s],a&&(e=t[a.name],e&&(e.showSlotData(a),"null"!=e.attachmentName?e.showDisplayByName(e.attachmentName):e.showDisplayByIndex(e.displayIndex)))}},a.getSkinIndexByName=function(t){for(var i,e=0,a=this.skinDataArray.length;a>e;e++)if(i=this.skinDataArray[e],i.name==t)return e;return-1},a.getGrahicsDataWithCache=function(t,i){return this._graphicsCache[t][i]},a.setGrahicsDataWithCache=function(t,i,e){this._graphicsCache[t][i]=e},a.destroy=function(){this.url&&delete i.TEMPLET_DICTIONARY[this.url]},a.getAniNameByIndex=function(t){var i=this.getAnimation(t);return i?i.name:null},r(0,a,"rate",function(){return this._rate}),i.TEMPLET_DICTIONARY=null,i}(k),w=function(t){function i(t,e){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,i.__super.call(this),void 0===e&&(e=0),t&&this.init(t,e)}s(i,"laya.ani.bone.Skeleton",t);var n=i.prototype;return n.init=function(t,i){if(void 0===i&&(i=0),1==i){this._graphicsCache=[];for(var e=0,a=t.getAnimationCount();a>e;e++)this._graphicsCache.push([])}this._yReverseMatrix=t.yReverseMatrix,this._aniMode=i,this._templet=t,this._player=new F(t.rate),this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._ikArr=t.ikArr,this._boneList=t.mBoneArr,this._rootBone=t.mRootBone,this._aniSectionDic=t.aniSectionDic,this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},n.load=function(t,i,a){void 0===a&&(a=0),this._aniPath=t,this._complete=i,this._loadAniMode=a,this._texturePath=t.replace(".sk",".png").replace(".bin",".png"),e.loader.load([{url:t,type:"arraybuffer"},{url:this._texturePath,type:"image"}],_.create(this,this._onLoaded))},n._onLoaded=function(){var t=c.getRes(this._texturePath),i=c.getRes(this._aniPath);if(null!=t&&null!=i){null==N.TEMPLET_DICTIONARY&&(N.TEMPLET_DICTIONARY={});var e;e=N.TEMPLET_DICTIONARY[this._aniPath],e?e.isParseFail?this._parseFail():this._parseComplete():(e=new N,e.url=this._aniPath,N.TEMPLET_DICTIONARY[this._aniPath]=e,e.on("complete",this,this._parseComplete),e.on("error",this,this._parseFail),e.parseData(t,i,60))}},n._parseComplete=function(){var t=N.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},n._parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败")},n._onPlay=function(){this.event("played")},n._onStop=function(){this.event("stopped")},n._onPause=function(){this.event("paused")},n._parseSrcBoneMatrix=function(){var t=0,i=0;for(i=this._templet.srcBoneMatrixArr.length,t=0;i>t;t++)this._boneMatrixArray.push(new d);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var e,a,s=this._templet.boneSlotArray;for(t=0,i=s.length;i>t;t++)e=s[t],a=this._bindBoneBoneSlotDic[e.parent],null==a&&(this._bindBoneBoneSlotDic[e.parent]=a=[]),this._boneSlotDic[e.name]=e=e.copy(),a.push(e),this._boneSlotArray.push(e)}},n._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var i=e.timer.currTimer;if(t&&this._player.update(i-this._lastTime),this._lastTime=i,this._aniClipIndex=this._player.currentAnimationClipIndex,this._clipIndex=this._player.currentKeyframeIndex,-1!=this._aniClipIndex){var a;if(0==this._aniMode){if(a=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics=a)}else if(1==this._aniMode&&(a=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex)))return void(this.graphics=a);this._createGraphics()}}},n._createGraphics=function(){var t=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._clipIndex,this._player.currentFrameTime);var i,e,a,s,r,n=this._aniSectionDic[this._aniClipIndex],h=0,l=0,o=0,u=0,_=0,c=this._templet.srcBoneMatrixArr.length;for(l=0,_=n[0];c>l;l++)r=this._boneList[l],i=this._boneMatrixArray[l],s=this._templet.srcBoneMatrixArr[l],r.resultTransform.scX=s.scX*this._curOriginalData[h++],r.resultTransform.skX=s.skX+this._curOriginalData[h++],r.resultTransform.skY=s.skY+this._curOriginalData[h++],r.resultTransform.scY=s.scY*this._curOriginalData[h++],r.resultTransform.x=s.x+this._curOriginalData[h++],r.resultTransform.y=s.y+this._curOriginalData[h++];var p,f={},y={};for(_+=n[1];_>l;l++)p=t[l],f[p.name]=this._curOriginalData[h++],y[p.name]=this._curOriginalData[h++],this._curOriginalData[h++],this._curOriginalData[h++],this._curOriginalData[h++],this._curOriginalData[h++];var m={},x={};for(_+=n[2];_>l;l++)p=t[l],m[p.name]=this._curOriginalData[h++],x[p.name]=this._curOriginalData[h++],this._curOriginalData[h++],this._curOriginalData[h++],this._curOriginalData[h++];this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(d.TEMP.identity());var g,D,v,I;for(l=0,_=this._ikArr.length;_>l;l++)switch(g=this._ikArr[l],D=this._boneList[g.targetBoneIndex],g.boneIndexs.length){case 1:I=this._boneList[g.boneIndexs[0]],this._applyIk1(I,D.resultMatrix.tx,D.resultMatrix.ty,g.mix);break;case 2:v=this._boneList[g.boneIndexs[0]],I=this._boneList[g.boneIndexs[1]],m[g.name]?this._applyIk2(v,I,D.resultMatrix.tx,D.resultMatrix.ty,m[g.name],x[g.name]):this._applyIk2(v,I,D.resultMatrix.tx,D.resultMatrix.ty,g.bendDirection,g.mix)}for(l=0,u=this._boneList.length;u>l;l++)if(r=this._boneList[l],a=this._bindBoneBoneSlotDic[r.name],r.resultMatrix.copyTo(this._boneMatrixArray[l]),a)for(o=0,_=a.length;_>o;o++)e=a[o],e&&e.setParentMatrix(r.resultMatrix);var M;0==this._aniMode||1==this._aniMode?this.graphics=new S:this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=new S,M=this.graphics;var T=NaN,b=NaN;for(l=0,_=this._boneSlotArray.length;_>l;l++)e=this._boneSlotArray[l],T=f[e.name],b=y[e.name],isNaN(b)||(M.save(),M.alpha(b)),isNaN(T)||e.showDisplayByIndex(T),e.draw(M,this._boneMatrixArray,this,2==this._aniMode),isNaN(b)||M.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,this._clipIndex,M):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,this._clipIndex,M)},n._applyIk1=function(t,e,a,s){var r=t._parent,n=1/(r.resultMatrix.a*r.resultMatrix.d-r.resultMatrix.b*r.resultMatrix.c),h=e-r.resultMatrix.tx,l=a-r.resultMatrix.ty,o=(h*r.resultMatrix.d-l*r.resultMatrix.b)*n-t.transform.x,u=(l*r.resultMatrix.a-h*r.resultMatrix.c)*n-t.transform.y,_=Math.atan2(u,o)*i.radDeg-0-t.transform.skX;t.transform.scX<0&&(_+=180),_>180?_-=360:-180>_&&(_+=360),t.transform.skX=t.transform.skY=t.transform.skX+_*s,t.update()},n._applyIk2=function(t,e,a,s,r,n){if(0!=n){var h=t.resultTransform.x,l=t.resultTransform.y,o=t.resultTransform.scX,u=t.resultTransform.scY,_=e.resultTransform.scX,c=0,p=0,d=0;0>o?(o=-o,c=180,d=-1):(c=0,d=1),0>u&&(u=-u,d=-d),0>_?(_=-_,p=180):p=0;var f=e.resultTransform.x,y=NaN,m=NaN,x=NaN,g=t.resultMatrix.a,D=t.resultMatrix.b,v=t.resultMatrix.c,I=t.resultMatrix.d,M=Math.abs(o-u)<=1e-4;
M?(y=e.resultTransform.y,m=g*f+D*y+t.resultMatrix.tx,x=v*f+I*y+t.resultMatrix.ty):(y=0,m=g*f+t.resultMatrix.tx,x=v*f+t.resultMatrix.ty);var T=t._parent;g=T.resultMatrix.a,D=T.resultMatrix.b,v=T.resultMatrix.c,I=T.resultMatrix.d;var b=1/(g*I-D*v),A=a-T.resultMatrix.tx,C=s-T.resultMatrix.ty,F=(A*I-C*D)*b-h,k=(C*g-A*v)*b-l;A=m-T.resultMatrix.tx,C=x-T.resultMatrix.ty;var S=(A*I-C*D)*b-h,N=(C*g-A*v)*b-l,w=Math.sqrt(S*S+N*N),P=e.length*_,U=NaN,B=NaN;if(M){P*=o;var L=(F*F+k*k-w*w-P*P)/(2*w*P);-1>L?L=-1:L>1&&(L=1),B=Math.acos(L)*r,g=w+P*L,D=P*Math.sin(B),U=Math.atan2(k*g-F*D,F*g+k*D)}else{g=o*P,D=u*P;var E=g*g,R=D*D,O=F*F+k*k,X=Math.atan2(k,F);v=R*w*w+E*O-E*R;var Y=-2*R*w,K=R-E;if(I=Y*Y-4*K*v,I>0){var W=Math.sqrt(I);0>Y&&(W=-W),W=-(Y+W)/2;var G=W/K,V=v/W,q=Math.abs(G)<Math.abs(V)?G:V;O>=q*q&&(C=Math.sqrt(O-q*q)*r,U=X-Math.atan2(C,q),B=Math.atan2(C/u,(q-w)/o))}var z=0,Q=Number.MAX_VALUE,$=0,Z=0,H=0,J=0,j=0,tt=0;A=w+g,I=A*A,I>J&&(H=0,J=I,j=A),A=w-g,I=A*A,Q>I&&(z=Math.PI,Q=I,$=A);var it=Math.acos(-g*w/(E-R));A=g*Math.cos(it)+w,C=D*Math.sin(it),I=A*A+C*C,Q>I&&(z=it,Q=I,$=A,Z=C),I>J&&(H=it,J=I,j=A,tt=C),(Q+J)/2>=O?(U=X-Math.atan2(Z*r,$),B=z*r):(U=X-Math.atan2(tt*r,j),B=H*r)}var et=Math.atan2(y,f)*d,at=t.transform.skX;U=(U-et)*i.radDeg+c-at,U>180?U-=360:-180>U&&(U+=360),t.resultTransform.x=h,t.resultTransform.y=l,t.resultTransform.skX=t.resultTransform.skY=at+U*n,at=e.transform.skX,at%=360,B=((B+et)*i.radDeg-0)*d+p-at,B>180?B-=360:-180>B&&(B+=360),e.resultTransform.x=f,e.resultTransform.y=y,e.resultTransform.skX=e.resultTransform.skY=e.resultTransform.skY+B*n,t.update()}},n.getAnimNum=function(){return this._templet.getAnimationCount()},n.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},n.getSlotByName=function(t){return this._boneSlotDic[t]},n.showSkinByName=function(t){this._skinIndex=this._templet.getSkinIndexByName(t),this.showSkinByIndex(this._skinIndex)},n.showSkinByIndex=function(t){this._skinIndex=t,this._templet.showSkinByIndex(this._boneSlotDic,t),this._clearCache()},n.showSlotSkinByIndex=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.showDisplayByIndex(i),this._clearCache()}},n.setSlotSkin=function(t,i){if(0!=this._aniMode){var e=this.getSlotByName(t);e&&e.replaceSkin(i),this._clearCache()}},n._clearCache=function(){if(1==this._aniMode)for(var t=0,i=this._graphicsCache.length;i>t;t++)this._graphicsCache[t].length=0},n.play=function(t,i,a){void 0===a&&(a=!0),this._indexControl=!1;var s=-1,r=NaN;if(r=i?Number.MAX_VALUE:0,"string"==typeof t)for(var n=0,l=this._templet.getAnimationCount();l>n;n++){var o=this._templet.getAnimation(n);if(o&&t==o.name){s=n;break}}else s=t;s>-1&&s<this.getAnimNum()&&(a||this._pause||this._currAniIndex!=s)&&(this._currAniIndex=s,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(s)),this._player.play(s,this._player.playbackRate,r),this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=h.now(),e.stage.frameLoop(1,this,this._update,null,!0)))},n.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),e.timer.clear(this,this._update))},n.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},n.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),e.timer.clear(this,this._update))},n.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=h.now(),e.stage.frameLoop(1,this,this._update,null,!0))},n._getGrahicsDataWithCache=function(t,i){return this._graphicsCache[t][i]},n._setGrahicsDataWithCache=function(t,i,e){this._graphicsCache[t][i]=e},n.destroy=function(i){void 0===i&&(i=!0),t.prototype.destroy.call(this,i),this._templet=null,this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,e.timer.clear(this,this._update)},r(0,n,"index",function(){return this._index},function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),r(0,n,"player",function(){return this._player}),r(0,n,"url",function(){return this._aniPath},function(t){this.load(t)}),r(0,n,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),a(i,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180}]),i}(m);(function(t){function i(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._loadedImage={},this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this.interval=30,this.loop=!1,i.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,this._parentMovieClip=t,t?(this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this.on("display",this,this._$3__onDisplay),this.on("undisplay",this,this._$3__onDisplay))}s(i,"laya.ani.swf.MovieClip",t);var a=i.prototype;return a.destroy=function(i){void 0===i&&(i=!0),this._clear(),t.prototype.destroy.call(this,i)},a._$3__onDisplay=function(){this._displayedInStage?e.timer.loop(this.interval,this,this.updates,null,!0):e.timer.clear(this,this.updates)},a.updates=function(){if(!this._parentMovieClip){var t=0,i=0;for(i=this._movieClipList.length,t=0;i>t;t++)this._movieClipList[t]&&this._movieClipList[t]._update()}},a.addLabel=function(t,i){this._labels||(this._labels={}),this._labels[i]=t},a.removeLabel=function(t){if(t){if(!this._labels)for(var i in this._labels)if(this._labels[i]===t){delete this._labels[i];break}}else this._labels=null},a._update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex])}},a.stop=function(){this._playing=!1},a.gotoAndStop=function(t){this.index=t,this.stop()},a._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){e.timer.clear(this,this.updates);var t=0,i=0;for(i=this._movieClipList.length,t=0;i>t;t++)this._movieClipList[t]!=this&&this._movieClipList[t]._clear();this._movieClipList.length=0}var a;for(a in this._loadedImage)this._loadedImage[a]&&(c.clearRes(a),this._loadedImage[a]=!1);this.removeChildren(),this.graphics=null,this._parentMovieClip=null},a.play=function(t,i){void 0===t&&(t=0),void 0===i&&(i=!0),this.loop=i,this._playing=!0,this._data&&this._displayFrame(t)},a._displayFrame=function(t){void 0===t&&(t=-1),-1!=t&&(this._curIndex>t&&this._reset(),this._parse(t))},a._reset=function(t){void 0===t&&(t=!0),t&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},a._parse=function(t){var e,a,s,r=0,n=0,h=0,l=0,o=!1,u=this._idOfSprite,_=this._data;for(this._ended&&this._reset(),_.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&t<this._preIndex&&(this._reset(!0),_.pos=this._Pos);this._curIndex<=t&&!this._ended;)switch(n=_.getUint16()){case 12:if(r=_.getUint16(),h=this._ids[_.getUint16()],this._Pos=_.pos,_.pos=h,0==(l=_.getUint8())){var c=_.getUint16();if(a=u[r],!a){a=u[r]=new m;var p=new m;p.loadImage(this.basePath+c+".png"),this._loadedImage[this.basePath+c+".png"]=!0,a.addChild(p),p.size(_.getFloat32(),_.getFloat32());var f=_._getMatrix();p.transform=f}a.alpha=1}else 1==l&&(e=u[r],e||(u[r]=e=new i(this),e.interval=this.interval,e._ids=this._ids,e.basePath=this.basePath,e._setData(_,h),e._initState(),e.play(0)),e.alpha=1);_.pos=this._Pos;break;case 3:this.addChild(u[_.getUint16()]).zOrder=_.getUint16(),o=!0;break;case 4:u[_.getUint16()].removeSelf();break;case 5:u[_.getUint16()][i._ValueList[_.getUint16()]]=_.getFloat32();break;case 6:u[_.getUint16()].visible=_.getUint8()>0;break;case 7:a=u[_.getUint16()];var y=a.transform||d.create();y.setTo(_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32(),_.getFloat32()),a.transform=y;break;case 8:u[_.getUint16()].setPos(_.getFloat32(),_.getFloat32());break;case 9:u[_.getUint16()].setSize(_.getFloat32(),_.getFloat32());break;case 10:u[_.getUint16()].alpha=_.getFloat32();break;case 11:u[_.getUint16()].setScale(_.getFloat32(),_.getFloat32());break;case 98:s=_.getString(),this.event(s),"stop"==s&&this.stop();break;case 99:this._curIndex=_.getUint16(),o&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=_.pos},a._setData=function(t,i){this._data=t,this._start=i+3},a.load=function(t){t=D.formatURL(t),this.basePath=t.split(".swf")[0]+"/image/",this.stop(),this._clear(),this._movieClipList=[this];var i=c.getRes(t);i?this._initData(i):e.loader.load(t,_.create(this,this._onLoaded),null,"arraybuffer")},a._onLoaded=function(t){t&&this._initData(t)},a._initState=function(){this._reset(),this._ended=!1;var t=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=t},a._initData=function(t){this._data=new l(t);var i=0,a=this._data.getUint16();for(i=0;a>i;i++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||e.timer.loop(this.interval,this,this.updates,null,!0)},r(0,a,"index",function(){return this._playIndex},function(t){this._playIndex=t,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])}),r(0,a,"url",null,function(t){this.load(t)}),r(0,a,"count",function(){return this._count}),r(0,a,"playing",function(){return this._playing}),i._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"],i})(m)}(window,document,Laya);